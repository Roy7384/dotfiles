on:
  push:
    branches:
      - master

jobs:
  gitleaks-full-history:
    name: Gitleaks full-history scan (Docker)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run gitleaks (Docker) â€” full history
        run: |
          docker run --rm \
            -v "${{ github.workspace }}":/src \
            zricethezav/gitleaks:latest \
            detect --source /src --format=json --report=/src/gitleaks-report.json --redact --verbose

      - name: Upload gitleaks report
        uses: actions/upload-artifact@v4
        with:
          name: gitleaks-report
          path: gitleaks-report.json
